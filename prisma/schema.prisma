// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model NguoiDung {
  ma            Int       @id @default(autoincrement()) @map("ma")
  ho     String?   @map("ho") @db.VarChar(255)
  ten      String?   @map("ten") @db.VarChar(255)
  email         String    @unique @db.VarChar(255)
  mat_khau      String?   @map("mat_khau") @db.VarChar(255)
  so_dien_thoai   String?   @map("so_dien_thoai") @db.VarChar(20)
  vai_tro          String    @map("vai_tro") @db.VarChar(50)
  ma_google      String?   @unique @map("ma_google") @db.VarChar(255)
  refreshToken  String?   @map("refreshToken") @db.Text
  xac_thuc_email Boolean   @default(false) @map("xac_thuc_email")
  ma_xac_nhan   String?   @map("ma_xac_nhan") @db.VarChar(255)
  ma_dat_lai    String?   @map("ma_dat_lai") @db.VarChar(255)
  han_ma_dat_lai  DateTime? @map("han_ma_dat_lai")
  ngay_tao     DateTime  @default(now()) @map("ngay_tao")
  ngay_cap_nhat     DateTime  @updatedAt @map("ngay_cap_nhat")

  donHangs DonHang[]
  danhGias DanhGia[]
  tinTucs  TinTuc[]

  @@map("NguoiDung")
}

// ThuongHieu
model ThuongHieu {
  ma       Int       @id @default(autoincrement())
  ten      String    @db.VarChar(255)
  mota     String?   @db.Text
  sanPhams SanPham[]
}

// DanhMuc
model DanhMuc {
  ma           Int           @id @default(autoincrement())
  ten          String        @db.VarChar(255)
  mota         String?       @db.Text
  sanPhams     SanPham[]
  loaiSanPhams LoaiSanPham[]
}

// LoaiSanPham
model LoaiSanPham {
  ma        Int       @id @default(autoincrement())
  ten       String    @db.VarChar(255)
  mota      String?   @db.Text
  hinhanh   String?   @db.Text
  noibat    Boolean  @default(false)
  madanhmuc Int
  danhMuc   DanhMuc   @relation(fields: [madanhmuc], references: [ma])
  sanPhams  SanPham[]
}

// SanPham
model SanPham {
  ma            Int      @id @default(autoincrement())
  ten           String   @db.VarChar(255)
  mota          String?  @db.Text
  giaban   Decimal @db.Decimal(30, 3)
  giagiam  Decimal? @db.Decimal(30, 3)
  hinhanh       String?  @db.Text
  noibat        Boolean  @default(false)
  trangthai     Boolean  @default(true)
  madanhmuc     Int
  maloaisanpham Int
  mathuonghieu  Int

  danhMuc     DanhMuc     @relation(fields: [madanhmuc], references: [ma])
  loaiSanPham LoaiSanPham @relation(fields: [maloaisanpham], references: [ma])
  thuongHieu  ThuongHieu  @relation(fields: [mathuonghieu], references: [ma])

  bienThes        BienThe[]
   hinhAnhMauSacs HinhAnhMauSac[]
  chiTietDonHangs ChiTietDonHang[]
  danhGias        DanhGia[]
}

// BienThe
model BienThe {
  ma       Int     @id @default(autoincrement())
  gia       Decimal @db.Decimal(30, 3)
  soluong  Int
  masp      Int
  mamausac Int
  makichco Int

  sanPham         SanPham          @relation(fields: [masp], references: [ma], onDelete: Cascade)
  mauSac          MauSac           @relation(fields: [mamausac], references: [ma])
  kichCo          KichCo           @relation(fields: [makichco], references: [ma])
  chiTietDonHangs ChiTietDonHang[]
  //  @@unique([masp, mamausac])
}

// KichCo
model KichCo {
  ma   Int    @id @default(autoincrement())
  ten  String


  bienThes BienThe[]
}

// MauSac
model MauSac {
  ma     Int    @id @default(autoincrement())
  ten    String
  ma_mau String
  bienThes       BienThe[]
  hinhAnhMauSacs HinhAnhMauSac[]
}

// HinhAnhMauSac
model HinhAnhMauSac {
  ma       Int     @id @default(autoincrement())
  hinhAnh  String
  anhChinh Boolean
  mamausac Int
  masp Int

  sanPham SanPham @relation(fields: [masp], references: [ma], onDelete: Cascade)
  mauSac MauSac @relation(fields: [mamausac], references: [ma])
}

// DonHang
model DonHang {
  ma              Int              @id @default(autoincrement())
  ngaydat         DateTime         @default(now())
  ho              String
  ten             String
  email           String?
  giamgia         Decimal? @db.Decimal(30, 3)
  tamtinh         Decimal @db.Decimal(30, 3)
  diachi          String
  thanhpho        String
  quan            String
  phuong          String
  ngaygiao        DateTime?
  ngayhuy         DateTime?
  sdt             String
  tonggia         Decimal @db.Decimal(30, 3)
  trangthai       TrangThaiDonHang
  phuongthucgiaohang String
  phigiaohang     Decimal @db.Decimal(30, 3)
  ghichu          String?
  manguoidung     Int?
  maKhuyenMai     Int?
  khuyenMai       KhuyenMai?       @relation(fields: [maKhuyenMai], references: [ma])
  nguoiDung       NguoiDung?        @relation(fields: [manguoidung], references: [ma])
  chiTietDonHangs ChiTietDonHang[]
  thanhToans      ThanhToan[]
}

// ChiTietDonHang
model ChiTietDonHang {
  ma        Int     @id @default(autoincrement())
  soluong   Int
  dongia    Decimal @db.Decimal(30, 3)
  masp      Int
  madh      Int
  mabienthe Int

  sanPham SanPham @relation(fields: [masp], references: [ma])
  donHang DonHang @relation(fields: [madh], references: [ma],  onDelete: Cascade)
  bienThe BienThe @relation(fields: [mabienthe], references: [ma])
}

// KhuyenMai
model KhuyenMai {
  ma            Int           @id @default(autoincrement())
  ten           String        @db.VarChar(255)
  loaikhuyenmai LoaiKhuyenMai
  giatrigiam    Float
  giatridonhang Float
  ngaybatdat    DateTime
  ngayketthuc   DateTime
  DonHang       DonHang[]
}

// ThanhToan
model ThanhToan {
  ma            Int      @id @default(autoincrement())
  phuongthuc    String   @db.VarChar(100)
  ngaythanhtoan DateTime
  trangthai     Boolean
  madh          Int

  donHang DonHang @relation(fields: [madh], references: [ma],  onDelete: Cascade)
}

// DanhGia
model DanhGia {
  ma          Int    @id @default(autoincrement())
  sosao       Int
  binhluan    String
  manguoidung Int
  masp        Int

  nguoiDung NguoiDung @relation(fields: [manguoidung], references: [ma])
  sanPham   SanPham   @relation(fields: [masp], references: [ma], onDelete: Cascade)
}

// TinTuc
model TinTuc {
  ma          Int      @id @default(autoincrement())
  tieude      String
  noidung     String
  ngaydang    DateTime
  hinhanh     String
  manguoidung Int

  nguoiDung NguoiDung @relation(fields: [manguoidung], references: [ma])
}

enum TrangThaiDonHang {
  da_dat
  dang_xu_ly
  da_huy
  dang_giao_hang
  da_giao_hang
}

enum LoaiKhuyenMai {
  giam_gia_theo_tien
  giam_gia_theo_phan_tram
}
